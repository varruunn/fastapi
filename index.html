<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI Note Project</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-zinc-300">
    <div class="max-w-2xl mx-auto mt-8">
        <h1 class="text-3xl font-bold mb-4">My Notes</h1>

        <form id="note-form" class="mb-6 space-y-3">
            <div>
                <label class="block text-sm font-medium mb-1">Title</label>
                <input 
                id="title"
                type="text"
                class="w-full border rounded px-3 py-2"
                required
                />
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Content</label>
                <textarea
                id="content"
                class="w-full border rounded px-3 py-2"
                rows="3"
                required
                ></textarea>
            </div>

            <button
            type="submit"
            class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 cursor-pointer"
            >
            Add Note
        </button>
        </form>

        <!-- search  -->
         <div class="mb-4">
            <input
            id="search"
            type="text"
            placeholder="Search notes..."
            class="w-full border rounded px-3 py-2"
            />
        </div>

        <ul id="notes-list" class="space-y-3"></ul>
    </div>

    <script>
        async function loadNotes(search = ''){
            let url = "http://127.0.0.1:8000/notes";
            if(search && search.trim()!== ''){
                const params = new URLSearchParams({search});
                url+=`?${params.toString()}`;
            }
            const response = await fetch(url);
            const notes = await response.json();

            const list = document.getElementById("notes-list");
            list.innerHTML = '';

            notes.forEach((note) => {
                const li = document.createElement("li");
                li.className  = "bg-white p-4 rounded shadow cursor-pointer hover:bg-gray-100";
                li.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-xl font-semibold mb-2">${note.title}</h2>
                        <p>${note.content}</p>
                        </div>
                        <div class="space-x-2">
                            <button
                            class="text-sm text-blue-600 hover:text-blue-800 cursor-pointer"
                            data-edit-id="${note.id}"
                            >
                            Edit
                            </button>
                            <button
                            class="text-sm text-red-600 hover:text-red-800 cursor-pointer"
                            data-id="${note.id}"
                            >
                            Delete
                            </button>
                            </div>
                            </div>
                            `;
                                list.appendChild(li);
            });

            document.querySelectorAll('button[data-id]').forEach((button) => {
                button.addEventListener('click', async () => {
                    const id = button.getAttribute('data-id');
                    await fetch(`http://127.0.0.1:8000/notes/${id}`, {
                        method: 'DELETE',
                    });
                    loadNotes();
                });
            });

            // edit handlers
            document.querySelectorAll('button[data-edit-id]').forEach((button) => {
                button.addEventListener('click', async () => {
                    const id = button.getAttribute('data-edit-id');

                    const currentTitle = prompt('New title (leave blank to keep):');
                    const currentContent = prompt('New content (leave blank to keep):');
                    
                    const body = {};
                    if (currentTitle !== null && currentTitle !== '') {
                        body.title = currentTitle;
                    }
                    if (currentContent !== null && currentContent !== '') {
                        body.content = currentContent;
                    }
                    
                    if (Object.keys(body).length === 0) {
                        return; // nothing to update
                        }

                        await fetch(`http://127.0.0.1:8000/notes/${id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(body),
                        });

                        loadNotes();
                    });
                });
        }

        document.getElementById("note-form").addEventListener("submit", async (event) => {
            event.preventDefault();

            const title = document.getElementById("title").value;
            const content = document.getElementById("content").value;

            await fetch("http://127.0.0.1:8000/notes", {
                method: "POST",
                headers: { "Content-Type" : "application/json" },
                body: JSON.stringify({title, content}),
            });

            document.getElementById("title").value = "";
            document.getElementById("content").value = "";

            loadNotes();
        })

        // search handler
        const searchInput = document.getElementById('search');
        if (searchInput) {
            searchInput.addEventListener('input', (event) => {
                const value = event.target.value;
                loadNotes(value);
            });
        }

        loadNotes();
    </script>
</body>
</html>